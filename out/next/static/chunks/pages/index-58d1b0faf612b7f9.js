(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(2603)}])},2603:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return a}});var s=t(5893),o=t(7294),r=t(7066);function a(){let[e,n]=o.useState(null),t=async e=>{if(!e.stsTokenManager)return!1;let n=new Date().getTime();console.log("currentTime",n);let t=n<e.stsTokenManager.expirationTime;if(t)return console.log("Token is still valid it expires at ".concat(e.stsTokenManager.expirationTime)),!0;{let e=await a();return e?(console.log("Token refreshed"),!0):(console.log("Token not refreshed"),!1)}};async function a(){let n="https://securetoken.googleapis.com/v1/token?key=".concat(e.apiKey),t={grant_type:"refresh_token",refresh_token:e.stsTokenManager.refreshToken};try{let s=await r.Z.post(n,t,{headers:{"Content-Type":"application/json"}}),o=s.data;console.log("Token refreshed",o);let a={...e};return a.stsTokenManager.accessToken=o.access_token,a.stsTokenManager.expirationTime=new Date().getTime()+1e3*o.expires_in,chrome.storage.local.set({user:a}),!0}catch(e){return console.error("Error refreshing token",e),!1}}(0,o.useEffect)(()=>{i()},[]);let i=()=>{chrome.storage.local.get(["user"],e=>{let s=e.user;s?(n(s),t(s)):console.log("User not signed in")})},c=async()=>{let e=await chrome.runtime.sendMessage({message:"sign_in"});e.success&&i()},l=async()=>{let e=await chrome.runtime.sendMessage({message:"sign_out"});e.success&&n(null)};return(0,s.jsx)("div",{children:e?(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{children:["Welcome ",e.displayName]}),(0,s.jsx)("button",{onClick:e=>{e.preventDefault(),l()},children:"Sign Out"})]}):(0,s.jsx)("button",{onClick:e=>{e.preventDefault(),c()},children:"Sign InLOOOL"})})}}},function(e){e.O(0,[66,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);